// #region Content
var jsonContents = {
  "FlatInfoCollection": [
    {
      "Number": "017",
      "Description": "C017",
      "OwnedBy": "Sandeep A Deshpande",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "4,600.00",
      "OutstandingOnSpecifiedDate": "1,600.00",
      "CurrentOutstanding": "1,600.00"
    },
    {
      "Number": "018",
      "Description": "C018",
      "OwnedBy": "Rajesh Singh",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "019",
      "Description": "C019",
      "OwnedBy": "Manjunath",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "24,240.00",
      "OutstandingOnSpecifiedDate": "24,240.00",
      "CurrentOutstanding": "24,240.00"
    },
    {
      "Number": "020",
      "Description": "C020",
      "OwnedBy": "B V Nagaraja",
      "CoOwnedBy": "-",
      "TenantName": "Manjunath K S",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "021",
      "Description": "C021",
      "OwnedBy": "Satyanarayana",
      "CoOwnedBy": "Chaya G",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "022",
      "Description": "C022",
      "OwnedBy": "Ganapathi M K",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "023",
      "Description": "C023",
      "OwnedBy": "B V Chandrashekar",
      "CoOwnedBy": "-",
      "TenantName": "Raghunath",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "15,683.00",
      "OutstandingOnSpecifiedDate": "15,683.00",
      "CurrentOutstanding": "15,683.00"
    },
    {
      "Number": "024",
      "Description": "C024",
      "OwnedBy": "B Mohan Sundaram",
      "CoOwnedBy": "Manika Lakshmi",
      "TenantName": "-",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,495.00",
      "OutstandingOnSpecifiedDate": "2,495.00",
      "CurrentOutstanding": "2,495.00"
    },
    {
      "Number": "117",
      "Description": "C117",
      "OwnedBy": "B V Siddalingaswamy",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "16,800.00",
      "OutstandingOnSpecifiedDate": "16,800.00",
      "CurrentOutstanding": "16,800.00"
    },
    {
      "Number": "118",
      "Description": "C118",
      "OwnedBy": "B V Prasad",
      "CoOwnedBy": "-",
      "TenantName": "Santhosh",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "5,600.00",
      "OutstandingOnSpecifiedDate": "2,800.00",
      "CurrentOutstanding": "2,800.00"
    },
    {
      "Number": "119",
      "Description": "C119",
      "OwnedBy": "Gangaiah",
      "CoOwnedBy": "Lalitha M R",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "14,000.00",
      "OutstandingOnSpecifiedDate": "14,000.00",
      "CurrentOutstanding": "14,000.00"
    },
    {
      "Number": "120",
      "Description": "C120",
      "OwnedBy": "Shivanand Chawhan",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "5,600.00",
      "OutstandingOnSpecifiedDate": "2,800.00",
      "CurrentOutstanding": "2,800.00"
    },
    {
      "Number": "121",
      "Description": "C121",
      "OwnedBy": "Girish",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "2,800.00",
      "CurrentOutstanding": "2,800.00"
    },
    {
      "Number": "122",
      "Description": "C122",
      "OwnedBy": "B J Abhishek",
      "CoOwnedBy": "Bharani K",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,845.00",
      "OutstandingOnSpecifiedDate": "2,845.00",
      "CurrentOutstanding": "2,845.00"
    },
    {
      "Number": "123",
      "Description": "C123",
      "OwnedBy": "Arun Joshi",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "6,239.00",
      "OutstandingOnSpecifiedDate": "6,239.00",
      "CurrentOutstanding": "6,239.00"
    },
    {
      "Number": "124",
      "Description": "C124",
      "OwnedBy": "V S Lokeswarappa",
      "CoOwnedBy": "Manoj L",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "217",
      "Description": "C217",
      "OwnedBy": "Srinivasa Rao Masanam",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "2,800.00",
      "CurrentOutstanding": "2,800.00"
    },
    {
      "Number": "218",
      "Description": "C218",
      "OwnedBy": "Laxmikanth Rao",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "2,800.00",
      "CurrentOutstanding": "2,800.00"
    },
    {
      "Number": "219",
      "Description": "C219",
      "OwnedBy": "Nagendra Murthy M",
      "CoOwnedBy": "Shobha B",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "5,600.00",
      "OutstandingOnSpecifiedDate": "5,600.00",
      "CurrentOutstanding": "5,600.00"
    },
    {
      "Number": "220",
      "Description": "C220",
      "OwnedBy": "Somala M",
      "CoOwnedBy": "Gopal N",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "20,100.00",
      "OutstandingOnSpecifiedDate": "20,100.00",
      "CurrentOutstanding": "20,100.00"
    },
    {
      "Number": "221",
      "Description": "C221",
      "OwnedBy": "Bhavani",
      "CoOwnedBy": "Ravi Prakash",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "222",
      "Description": "C222",
      "OwnedBy": "B V Chandrashekar",
      "CoOwnedBy": "-",
      "TenantName": "Harish",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "5,600.00",
      "OutstandingOnSpecifiedDate": "5,600.00",
      "CurrentOutstanding": "5,600.00"
    },
    {
      "Number": "223",
      "Description": "C223",
      "OwnedBy": "Praveen Gouda Patil",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "1,400.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "224",
      "Description": "C224",
      "OwnedBy": "Pradeepa K S",
      "CoOwnedBy": "Vaishnavi G R",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "317",
      "Description": "C317",
      "OwnedBy": "Santosh Kumar P",
      "CoOwnedBy": "Ashwini Krishnappa",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "0.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "318",
      "Description": "C318",
      "OwnedBy": "B V Chandrashekar",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Tenant",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "16,800.00",
      "OutstandingOnSpecifiedDate": "16,800.00",
      "CurrentOutstanding": "16,800.00"
    },
    {
      "Number": "319",
      "Description": "C319",
      "OwnedBy": "M G Harish Babu",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "18,240.00",
      "OutstandingOnSpecifiedDate": "18,240.00",
      "CurrentOutstanding": "18,240.00"
    },
    {
      "Number": "320",
      "Description": "C320",
      "OwnedBy": "Shrikanth MH",
      "CoOwnedBy": "Jyothi HC",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "0.00",
      "CurrentOutstanding": "0.00"
    },
    {
      "Number": "321",
      "Description": "C321",
      "OwnedBy": "Santosh P",
      "CoOwnedBy": "Nithya B",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "40,385.00",
      "OutstandingOnSpecifiedDate": "40,385.00",
      "CurrentOutstanding": "40,385.00"
    },
    {
      "Number": "322",
      "Description": "C322",
      "OwnedBy": "Sai Shravanth",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,800.00",
      "OutstandingOnSpecifiedDate": "2,800.00",
      "CurrentOutstanding": "2,800.00"
    },
    {
      "Number": "323",
      "Description": "C323",
      "OwnedBy": "Nikhil Kulkarni",
      "CoOwnedBy": "-",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "21,490.00",
      "OutstandingOnSpecifiedDate": "18,690.00",
      "CurrentOutstanding": "18,690.00"
    },
    {
      "Number": "324",
      "Description": "C324",
      "OwnedBy": "B V Nagaraja",
      "CoOwnedBy": "Deepa BN",
      "TenantName": "-",
      "ResidentType": "Owner",
      "AccountOpenedOn": "01 Sep 2022",
      "DateSpecified": "20 Sep 2022",
      "OpeningBalance": "2,600.00",
      "OutstandingOnSpecifiedDate": "2,600.00",
      "CurrentOutstanding": "2,600.00"
    }
  ],
  "TotalOutstanding": "2,28,717.0",
  "GeneratedOn": "20 Sep 2022",
  "ApartmentName": "SLV Parkview Apartment"
}
// #endregion

// #region Retrieve Table Elements
var tableHeader = document.querySelector(".table-header");
var tableBody = document.querySelector(".table-body");
// #endregion

// #region Data Required for Calculations
var outstandings = jsonContents.FlatInfoCollection.map(outstandingOnly)
var maxOutstanding = Math.max(...outstandings)
// #endregion

populateOutstandings();

// #region Populate Outstandings

function populateOutstandings() {

  var endOfData = "";
  var flatInfoCollection = jsonContents.FlatInfoCollection;

  tableBody.innerHTML = "";

  if (flatInfoCollection.length > 0) {

    var reportTill = jsonContents.FlatInfoCollection[0].DateSpecified;
    document.title = "Summary of Outstandings (" + reportTill + ")";
    document.querySelector(".table-title").innerHTML = "Summary of Outstandings as on " + reportTill;

    for (i = 0; i < flatInfoCollection.length; i++) {

      tableBody.innerHTML += `
            <tr>
                <td>${flatInfoCollection[i].Description}</td>
                <td>${flatInfoCollection[i].OwnedBy}</td>
                <td>${flatInfoCollection[i].CoOwnedBy}</td>
                <td>${flatInfoCollection[i].TenantName}</td>
                <td>${flatInfoCollection[i].ResidentType}</td>
                <td>${flatInfoCollection[i].OutstandingOnSpecifiedDate}</td>
            </tr>
            `;
    }

    endOfData = "**** End of Data ****";

  } else {

    endOfData = "**** No Records Found ****";

  }

  tableBody.innerHTML += `<tr class="total-outstanding">
            <td colspan="5" class="total-outstanding-desc">Total outstanding amount:</td>
            <td colspan="1" class="total-outstanding-amount">${jsonContents.TotalOutstanding}</td>
        </tr>`;

  tableBody.innerHTML += `<tr class="end-of-data">
            <td colspan="6">${endOfData}</td>
        </tr>`;
}

// #endregion

// #region Limits for Cell Backgrounds
var noFocus = 0.0
var lowFocus = 20.0
var normalFocus = 40.0
var aboveNormalFocus = 60.0
var mediumFocus = 80.0
// #endregion

changeElementBackground()

// #region Change Element Background

function changeElementBackground(elementIndex) {

  var flatCount = jsonContents.FlatInfoCollection.length;

  for (index = 0; index < flatCount; index++) {

    var tableRow = tableBody.children[index]

    var nameCell = tableRow.children[1]
    var outstandingCell = tableRow.children[tableRow.children.length - 1]

    var currentItemPercentage = getPercentage(outstandings[index], maxOutstanding)
    var focusClass

    if (currentItemPercentage <= noFocus) {
      focusClass = "no-focus"
    } else if (currentItemPercentage <= lowFocus) {
      focusClass = "low-focus"
    } else if (currentItemPercentage <= normalFocus) {
      focusClass = "normal-focus"
    } else if (currentItemPercentage <= aboveNormalFocus) {
      focusClass = "above-normal-focus"
    } else if (currentItemPercentage <= mediumFocus) {
      focusClass = "medium-focus"
    } else {
      focusClass = "high-focus"
    }
    nameCell.classList.add(focusClass)
    outstandingCell.classList.add(focusClass)

  }
}

// #endregion

// #region Helper Functions for Cell Coloring

function outstandingOnly(flatInfo) {
  let outstanding = parseFloat(flatInfo.OutstandingOnSpecifiedDate.replace(",", ""))
  return outstanding
}

function getPercentage(current, max) {
  return current / max * 100;
}

// #endregion

// #region Helper Functions

function getFilename(fullPath) {
  return fullPath.replace(/^.*[\\\/]/, "");
}

function getCurrentDirectory() {
  var location = window.location.pathname;
  return location.substring(0, location.lastIndexOf("/"));
}

// #endregion